<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ProHelmet — Payment Successful</title>

  <style>
    :root{
      --bg:#070a10;
      --text:#e9eef7;
      --muted:#a9b4c6;
      --line:rgba(255,255,255,.10);
      --ok:#22c55e;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      min-height:100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(1000px 600px at 50% 20%, rgba(45,76,140,.22), transparent 60%),
        radial-gradient(600px 400px at 20% 80%, rgba(0,200,255,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      padding:12px;
    }

    .wrap{ width:100%; max-width:420px; }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    .brand{ text-align:center; margin-bottom:8px; }
    .brand img{
      width:100%;
      max-width:380px;
      height:60px;
      object-fit:contain;
    }

    .caption{
      text-align:center;
      font-weight:700;
      font-size:18px;
      margin-bottom:12px;
    }

    .divider{ height:1px; background:var(--line); margin-bottom:16px; }

    .check{
      width:62px;
      height:62px;
      margin:0 auto 10px auto;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(34,197,94,.12);
      border:1px solid rgba(34,197,94,.28);
    }
    .check svg{ width:34px; height:34px; fill:var(--ok); }

    .title{
      text-align:center;
      font-size:26px;
      font-weight:900;
      margin:0 0 6px 0;
    }

    .pill{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      font-weight:800;
      margin-bottom:14px;
      text-align:center;
      word-break:break-all;
    }

    .info{
      text-align:center;
      color:var(--muted);
      font-size:12px;
      margin-bottom:14px;
    }

    .note{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      font-size:13px;
      color:var(--muted);
      margin-bottom:14px;
    }

    .wa{ text-align:center; font-weight:900; margin-top:10px; }
    .wa2{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      font-size:20px;
      font-weight:900;
      margin-top:6px;
    }

    .wa-link{ color:#25D366; text-decoration:none; font-weight:900; }
    .wa-link:hover{ text-decoration:underline; }

    .feedback-card{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:18px;
      padding:16px;
      margin-bottom:16px;
      text-align:center;
    }

    .feedback-title{ font-weight:900; margin-bottom:4px; }

    .feedback-sub{
      font-size:13px;
      color:var(--muted);
      margin-bottom:12px;
    }

    .stars{
      display:flex;
      justify-content:center;
      gap:8px;
      font-size:28px;
    }

    .star{
      display:inline-block;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      color:#555;
      transition:color .2s ease;
    }

    .star.active{ color:#facc15; }

    .feedback-text{
      width:100%;
      margin-top:12px;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.4);
      color:var(--text);
      resize:none;
    }

    .feedback-submit{
      margin-top:10px;
      padding:10px 16px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
    }

    .btn{
      display:block;
      text-align:center;
      padding:16px;
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      font-weight:800;
      text-decoration:none;
      color:var(--text);
      margin-bottom:12px;
    }

    .footer{
      text-align:center;
      font-size:12px;
      color:rgba(233,238,247,.55);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="brand">
        <img src="brand_header123.png" alt="PROHELMET">
      </div>

      <div class="caption">Stay Safe. Stay Fresh.</div>
      <div class="divider"></div>

      <div class="check">
        <svg viewBox="0 0 24 24">
          <path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/>
        </svg>
      </div>

      <div class="title">Payment Successful</div>

      <div class="pill">
        <span>Txn ID:</span>
        <b id="txnText">—</b>
      </div>

      <div class="info">Your helmet is now in the sanitization cycle.</div>

      <div class="note">
        If you encounter any issues with <b>payment</b> or the <b>cleaning cycle</b>,
        please reachout to us with your payment screenshot and we will assist you on priority.

        <div class="wa">Message us at WhatsApp:</div>

        <div class="wa2">
          <a id="waLink"
             class="wa-link"
             href="https://wa.me/917207400693"
             target="_blank"
             rel="noopener">
             7207400693
          </a>
        </div>
      </div>

      <input type="hidden" id="ratingValue" value="0">

      <!-- Feedback Section -->
      <div class="feedback-card" id="feedbackCard">
        <div class="feedback-title">We are new. Help us improve.</div>
        <div class="feedback-sub">Kindly give your words of encouragement.</div>

        <div class="stars" id="starContainer">
          <span class="star" data-value="1">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="5">★</span>
        </div>

        <textarea id="feedbackText"
                  class="feedback-text"
                  placeholder="Write your feedback..."
                  style="display:none;"></textarea>

        <button id="feedbackSubmit"
                class="feedback-submit"
                style="display:none;">
          Submit Feedback
        </button>
      </div>

      <a class="btn" href="https://prohelmet0210.github.io/Website/" target="_blank">
        Visit Official Website
      </a>

      <div class="footer">©PROHELMET</div>

    </div>
  </div>

  <script>
  /* ----------------------------
     SINGLE-SCOPE SCRIPT (NO IIFE)
     Purpose:
     - Show Txn ID
     - Update WhatsApp deep link
     - Feedback: star click auto-records rating; submit records feedback text
     - Sends POST to Apps Script (no-cors)
     ---------------------------- */

  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzbFuKtGwD8R4mTCapsVlEvvYzim_uhmYhAmbblifHXM8EvNC70z5P5HFL9vikeom4W/exec";
  const params = new URLSearchParams(window.location.search);

  function getParam(keys) {
    for (const key of keys) {
      const value = (params.get(key) || "").trim();
      if (value) return value;
    }
    return "";
  }

  const txnId = getParam([
    "razorpay_payment_link_id",
    "plink",
    "razorpay_payment_id"
  ]) || "—";

  const kioskId = (params.get("kiosk") || "").trim() || "UNKNOWN";

  // Render Txn ID
  const txnEl = document.getElementById("txnText");
  if (txnEl) txnEl.textContent = txnId;

  // WhatsApp deep link with Txn
  const waLink = document.getElementById("waLink");
  if (waLink) {
    const base = "https://wa.me/917207400693?text=";
    const msg = txnId === "—"
      ? "Hi ProHelmet, I need help with my payment/cleaning cycle."
      : `Hi ProHelmet, I need help with my payment/cleaning cycle. Txn: ${txnId}`;
    waLink.href = base + encodeURIComponent(msg);
  }

  // Feedback wiring after DOM is ready
  document.addEventListener("DOMContentLoaded", () => {
    let selectedRating = 0;

    const stars = document.querySelectorAll(".star");
    const feedbackText = document.getElementById("feedbackText");
    const feedbackSubmit = document.getElementById("feedbackSubmit");
    const ratingValueEl = document.getElementById("ratingValue");

    function postToSheet({ rating, feedback }) {
      const body = new URLSearchParams();
      body.set("txn_id", txnId);
      body.set("kiosk_id", kioskId);
      body.set("rating", String(rating || ""));
      body.set("feedback", (feedback || "").trim());

      // proof log (console)
      console.log("[PROHELMET FEEDBACK] POST", {
        txn_id: txnId,
        kiosk_id: kioskId,
        rating: rating,
        feedback: (feedback || "").trim()
      });

      return fetch(APPS_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        body
      });
    }

    stars.forEach(star => {
      star.addEventListener("click", () => {
        selectedRating = parseInt(star.getAttribute("data-value"), 10) || 0;

        // highlight stars
        stars.forEach(s => {
          const v = parseInt(s.getAttribute("data-value"), 10) || 0;
          s.classList.toggle("active", v <= selectedRating);
        });

        if (ratingValueEl) ratingValueEl.value = String(selectedRating);

        // show textarea + submit
        if (feedbackText) feedbackText.style.display = "block";
        if (feedbackSubmit) feedbackSubmit.style.display = "inline-block";

        // AUTO-RECORD rating-only
        postToSheet({ rating: selectedRating, feedback: "" }).catch(() => {});
      });
    });

    if (feedbackSubmit) {
      feedbackSubmit.addEventListener("click", () => {
        const txt = (feedbackText ? feedbackText.value : "").trim();
        postToSheet({ rating: selectedRating || 0, feedback: txt }).catch(() => {});
      });
    }
  });
  </script>
</body>
</html>
